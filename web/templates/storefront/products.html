{{define "title"}}Shop Coffee{{end}}

{{define "content"}}
<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
    <!-- Page Header -->
    <div class="mb-8 text-center">
        {{template "sf-heading" (dict "Level" "1" "Content" "Our Coffee")}}
        <p class="mt-4 text-lg text-neutral-600">
            Freshly roasted, ethically sourced coffee from around the world
        </p>
    </div>

    <!-- Filters Section -->
    <div class="mb-8" x-data="{ showMobileFilters: false }">
        <!-- Desktop Filters -->
        <div class="hidden md:flex items-center justify-between border-b border-neutral-200 pb-4">
            <div class="flex items-center gap-6">
                <!-- Roast Level Filter -->
                {{if .RoastLevels}}
                <div class="flex items-center gap-2">
                    <label for="roast-filter" class="text-sm text-neutral-500">Roast</label>
                    <select id="roast-filter"
                            onchange="applyFilters()"
                            class="border-0 bg-transparent py-1 pl-0 pr-6 text-sm font-medium text-neutral-900 focus:ring-0 cursor-pointer">
                        <option value="">All</option>
                        {{range .RoastLevels}}
                        <option value="{{.}}" {{if eq $.SelectedRoast .}}selected{{end}}>{{.}}</option>
                        {{end}}
                    </select>
                </div>
                {{end}}

                <!-- Origin Filter -->
                {{if .Origins}}
                <div class="flex items-center gap-2">
                    <label for="origin-filter" class="text-sm text-neutral-500">Origin</label>
                    <select id="origin-filter"
                            onchange="applyFilters()"
                            class="border-0 bg-transparent py-1 pl-0 pr-6 text-sm font-medium text-neutral-900 focus:ring-0 cursor-pointer">
                        <option value="">All</option>
                        {{range .Origins}}
                        <option value="{{.}}" {{if eq $.SelectedOrigin .}}selected{{end}}>{{.}}</option>
                        {{end}}
                    </select>
                </div>
                {{end}}

                <!-- Tasting Notes Filter -->
                {{if .TastingNotes}}
                <div class="flex items-center gap-2">
                    <label for="note-filter" class="text-sm text-neutral-500">Notes</label>
                    <select id="note-filter"
                            onchange="applyFilters()"
                            class="border-0 bg-transparent py-1 pl-0 pr-6 text-sm font-medium text-neutral-900 focus:ring-0 cursor-pointer">
                        <option value="">All</option>
                        {{range .TastingNotes}}
                        <option value="{{.}}" {{if eq $.SelectedNote .}}selected{{end}}>{{.}}</option>
                        {{end}}
                    </select>
                </div>
                {{end}}

                {{if .HasFilters}}
                <a href="/products" class="text-sm text-neutral-500 hover:text-neutral-700">
                    Clear
                </a>
                {{end}}
            </div>

            <span class="text-sm text-neutral-500">
                {{len .Products}} product{{if ne (len .Products) 1}}s{{end}}
            </span>
        </div>

        <!-- Mobile Filter Button -->
        <div class="md:hidden flex items-center justify-between">
            <button @click="showMobileFilters = true"
                    class="inline-flex items-center gap-2 rounded-lg border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-700">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                </svg>
                Filters
                {{if .HasFilters}}
                <span class="inline-flex items-center justify-center h-5 w-5 rounded-full bg-teal-600 text-xs font-medium text-white">
                    {{.ActiveFilterCount}}
                </span>
                {{end}}
            </button>
            <span class="text-sm text-neutral-500">
                {{len .Products}} product{{if ne (len .Products) 1}}s{{end}}
            </span>
        </div>

        <!-- Mobile Filter Modal -->
        <div x-show="showMobileFilters"
             x-cloak
             class="fixed inset-0 z-50 md:hidden">
            <div x-show="showMobileFilters"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0"
                 x-transition:enter-end="opacity-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100"
                 x-transition:leave-end="opacity-0"
                 @click="showMobileFilters = false"
                 class="fixed inset-0 bg-neutral-900/50"></div>

            <div x-show="showMobileFilters"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="translate-y-full"
                 x-transition:enter-end="translate-y-0"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="translate-y-0"
                 x-transition:leave-end="translate-y-full"
                 class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl p-6 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-neutral-900">Filters</h3>
                    <button @click="showMobileFilters = false" class="text-neutral-400 hover:text-neutral-500">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="space-y-6">
                    {{if .RoastLevels}}
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Roast Level</label>
                        <select id="mobile-roast-filter"
                                class="w-full rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                            <option value="">All Roasts</option>
                            {{range .RoastLevels}}
                            <option value="{{.}}" {{if eq $.SelectedRoast .}}selected{{end}}>{{.}}</option>
                            {{end}}
                        </select>
                    </div>
                    {{end}}

                    {{if .Origins}}
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Origin</label>
                        <select id="mobile-origin-filter"
                                class="w-full rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                            <option value="">All Origins</option>
                            {{range .Origins}}
                            <option value="{{.}}" {{if eq $.SelectedOrigin .}}selected{{end}}>{{.}}</option>
                            {{end}}
                        </select>
                    </div>
                    {{end}}

                    {{if .TastingNotes}}
                    <div>
                        <label class="block text-sm font-medium text-neutral-700 mb-2">Tasting Notes</label>
                        <select id="mobile-note-filter"
                                class="w-full rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-teal-500 focus:ring-1 focus:ring-teal-500">
                            <option value="">All Notes</option>
                            {{range .TastingNotes}}
                            <option value="{{.}}" {{if eq $.SelectedNote .}}selected{{end}}>{{.}}</option>
                            {{end}}
                        </select>
                    </div>
                    {{end}}
                </div>

                <div class="mt-8 flex gap-3">
                    {{if .HasFilters}}
                    <a href="/products" class="flex-1 rounded-lg border border-neutral-300 bg-white px-4 py-3 text-center text-sm font-medium text-neutral-700 hover:bg-neutral-50">
                        Clear All
                    </a>
                    {{end}}
                    <button onclick="applyMobileFilters()"
                            class="flex-1 rounded-lg bg-teal-700 px-4 py-3 text-sm font-medium text-white hover:bg-teal-800">
                        Apply Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Grid -->
    {{if .Products}}
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {{range .Products}}
        <a href="/products/{{.Slug}}" class="group">
            <article class="flex h-full flex-col rounded-lg bg-white border border-neutral-200 shadow-sm transition hover:shadow-md">
                <!-- Product Image -->
                <div class="aspect-square overflow-hidden rounded-t-lg bg-neutral-100">
                    {{if .ImageURL.Valid}}
                        <img src="{{.ImageURL.String}}" alt="{{.Name}}" class="h-full w-full object-cover transition group-hover:scale-105">
                    {{else}}
                        <div class="flex h-full items-center justify-center">
                            <svg class="h-20 w-20 text-neutral-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                    {{end}}
                </div>

                <!-- Product Info -->
                <div class="flex flex-1 flex-col p-6">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-neutral-900">
                            {{.Name}}
                        </h3>

                        {{if .Origin.Valid}}
                        <p class="mt-1 text-sm text-neutral-600">
                            {{.Origin.String}}
                        </p>
                        {{end}}

                        {{if .ShortDescription.Valid}}
                        <p class="mt-3 text-sm leading-6 text-neutral-700 line-clamp-2">
                            {{.ShortDescription.String}}
                        </p>
                        {{end}}

                        <!-- Attributes -->
                        <div class="mt-4 flex flex-wrap gap-2">
                            {{if .RoastLevel.Valid}}
                                {{template "sf-badge" (dict "Content" .RoastLevel.String "Color" "neutral")}}
                            {{end}}

                            {{if .TastingNotes}}
                                {{$notes := .TastingNotes}}
                                {{if gt (len $notes) 0}}
                                    {{template "sf-badge" (dict "Content" (index $notes 0) "Color" "amber")}}
                                {{end}}
                                {{if gt (len $notes) 1}}
                                    <span class="inline-flex items-center rounded px-2 py-0.5 text-xs font-medium bg-neutral-100 text-neutral-700 border border-neutral-200">
                                        +{{sub (len $notes) 1}} more
                                    </span>
                                {{end}}
                            {{end}}
                        </div>
                    </div>

                    <!-- Price -->
                    {{if .BasePrice.Valid}}
                    <div class="mt-4 flex items-baseline justify-between border-t border-neutral-200 pt-4">
                        <span class="text-sm text-neutral-500">Starting at</span>
                        <span class="text-xl font-bold text-neutral-900">
                            ${{printf "%.2f" (divf .BasePrice.Int32 100.0)}}
                        </span>
                    </div>
                    {{end}}

                    <!-- View Details Link -->
                    <div class="mt-4">
                        <span class="inline-flex items-center gap-2 text-sm font-medium text-teal-700 group-hover:text-teal-800 transition-colors">
                            View Details
                            <svg class="h-4 w-4 transition group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        </span>
                    </div>
                </div>
            </article>
        </a>
        {{end}}
    </div>
    {{else}}
    <!-- Empty State -->
    {{template "sf-empty-state" (dict
        "Icon" "<path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4\"/>"
        "Title" "No products available"
        "Description" "Check back soon for fresh roasted coffee")}}
    {{end}}
</div>

<script>
function applyFilters() {
    const roast = document.getElementById('roast-filter')?.value || '';
    const origin = document.getElementById('origin-filter')?.value || '';
    const note = document.getElementById('note-filter')?.value || '';

    const params = new URLSearchParams();
    if (roast) params.set('roast', roast);
    if (origin) params.set('origin', origin);
    if (note) params.set('note', note);

    const queryString = params.toString();
    window.location.href = '/products' + (queryString ? '?' + queryString : '');
}

function applyMobileFilters() {
    const roast = document.getElementById('mobile-roast-filter')?.value || '';
    const origin = document.getElementById('mobile-origin-filter')?.value || '';
    const note = document.getElementById('mobile-note-filter')?.value || '';

    const params = new URLSearchParams();
    if (roast) params.set('roast', roast);
    if (origin) params.set('origin', origin);
    if (note) params.set('note', note);

    const queryString = params.toString();
    window.location.href = '/products' + (queryString ? '?' + queryString : '');
}
</script>
{{end}}
