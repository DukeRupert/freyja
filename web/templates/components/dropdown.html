{{/*
  Dropdown Component - Catalyst UI Kit Style

  Usage:
    {{template "dropdown" (dict
      "Label" "Options"
      "Items" (list
        (dict "Label" "Edit" "Href" "/edit")
        (dict "Type" "divider")
        (dict "Label" "Delete" "HTMX" (dict "Method" "post" "URL" "/delete"))
      )
    )}}

  Parameters:
    - Label: Button label (required)
    - Items: List of dropdown items (required)
    - ButtonVariant: Button variant (default: "outline")
    - ButtonColor: Button color (default: "zinc")
    - Align: Menu alignment - "left" or "right" (default: "right")
    - Class: Additional CSS classes

  Item Types:
    - Link: {Label, Href, Icon}
    - HTMX Action: {Label, HTMX: {Method, URL, Target, Swap}, Icon}
    - Divider: {Type: "divider"}
*/}}

{{define "dropdown"}}
<div x-data="{ open: false }" class="relative {{.Class}}">
  <!-- Trigger button -->
  <button @click="open = !open"
          type="button"
          class="{{template "dropdown-button-classes" .}}">
    <span>{{.Label}}</span>
    <svg class="size-4 transition-transform duration-200"
         :class="open && 'rotate-180'"
         fill="none"
         viewBox="0 0 24 24"
         stroke="currentColor"
         stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Dropdown menu -->
  <div x-show="open"
       x-transition:enter="transition ease-out duration-100"
       x-transition:enter-start="transform opacity-0 scale-95"
       x-transition:enter-end="transform opacity-100 scale-100"
       x-transition:leave="transition ease-in duration-75"
       x-transition:leave-start="transform opacity-100 scale-100"
       x-transition:leave-end="transform opacity-0 scale-95"
       @click.away="open = false"
       x-cloak
       class="absolute {{if eq .Align "left"}}left-0{{else}}right-0{{end}} z-50 mt-2 w-56
              origin-top-{{if eq .Align "left"}}left{{else}}right{{end}}
              rounded-xl bg-white p-1 shadow-lg
              ring-1 ring-zinc-950/10
              dark:bg-zinc-900 dark:ring-white/10">
    {{range .Items}}
      {{if eq .Type "divider"}}
        <hr class="my-1 border-t border-zinc-950/5 dark:border-white/5">
      {{else if .HTMX}}
        <button hx-{{.HTMX.Method}}="{{.HTMX.URL}}"
                {{if .HTMX.Target}}hx-target="{{.HTMX.Target}}"{{end}}
                {{if .HTMX.Swap}}hx-swap="{{.HTMX.Swap}}"{{end}}
                @click="open = false"
                class="flex w-full items-center gap-2 rounded-lg px-3 py-2
                       text-left text-sm text-zinc-950
                       hover:bg-zinc-950/5 dark:text-white
                       dark:hover:bg-white/5 transition-colors">
          {{if .Icon}}
            <svg class="size-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              {{.Icon}}
            </svg>
          {{end}}
          {{.Label}}
        </button>
      {{else}}
        <a href="{{.Href}}"
           @click="open = false"
           class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm
                  text-zinc-950 hover:bg-zinc-950/5
                  dark:text-white dark:hover:bg-white/5 transition-colors">
          {{if .Icon}}
            <svg class="size-4 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              {{.Icon}}
            </svg>
          {{end}}
          {{.Label}}
        </a>
      {{end}}
    {{end}}
  </div>
</div>
{{end}}

{{define "dropdown-button-classes"}}
{{$variant := or .ButtonVariant "outline"}}
{{$color := or .ButtonColor "zinc"}}
inline-flex items-center gap-2 rounded-lg border text-sm/6 font-semibold
px-3 py-2 transition-colors
{{if eq $variant "outline"}}
  border-zinc-950/10 text-zinc-950 bg-transparent
  hover:border-zinc-950/20 hover:bg-zinc-950/[2.5%]
  dark:border-white/15 dark:text-white
  dark:hover:border-white/25 dark:hover:bg-white/5
{{else if eq $variant "solid"}}
  {{if eq $color "zinc"}}
    border-transparent bg-zinc-900 text-white
    hover:bg-zinc-800
    dark:bg-white dark:text-zinc-900 dark:hover:bg-zinc-100
  {{else if eq $color "blue"}}
    border-transparent bg-blue-600 text-white
    hover:bg-blue-700
    dark:bg-blue-500 dark:hover:bg-blue-600
  {{end}}
{{else}}
  border-transparent text-zinc-950 bg-transparent
  hover:bg-zinc-950/5
  dark:text-white dark:hover:bg-white/5
{{end}}
{{end}}
