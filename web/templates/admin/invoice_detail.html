{{define "title"}}Invoice {{.Invoice.Invoice.InvoiceNumber}}{{end}}

{{define "content"}}
<div class="space-y-8">
    <!-- Back Link -->
    <div>
        <a href="/admin/invoices"
           class="inline-flex items-center gap-2 text-sm/6 text-zinc-500 hover:text-zinc-950 dark:text-zinc-400 dark:hover:text-white">
            ← Back to Invoices
        </a>
    </div>

    <!-- Page Header with Actions -->
    <div class="flex items-start justify-between">
        <div>
            {{template "heading" (dict "Level" "2" "Content" (printf "Invoice %s" .Invoice.Invoice.InvoiceNumber))}}
            <p class="mt-2 text-base/7 text-zinc-600 dark:text-zinc-400">
                Created on {{.Invoice.Invoice.CreatedAt.Time.Format "January 2, 2006"}}
                {{if .Invoice.Invoice.DueDate.Valid}}
                • Due {{.Invoice.Invoice.DueDate.Time.Format "January 2, 2006"}}
                {{end}}
            </p>
        </div>
        <div class="flex items-center gap-3">
            {{if eq .Invoice.Invoice.Status "draft"}}
            <form method="POST" action="/admin/invoices/{{.Invoice.Invoice.ID}}/send">
                {{template "button" (dict
                    "Content" "Send Invoice"
                    "Type" "submit"
                    "Variant" "solid"
                    "Color" "blue")}}
            </form>
            <form method="POST" action="/admin/invoices/{{.Invoice.Invoice.ID}}/void"
                  onsubmit="return confirm('Are you sure you want to void this invoice?')">
                {{template "button" (dict
                    "Content" "Void"
                    "Type" "submit"
                    "Variant" "outline"
                    "Color" "red")}}
            </form>
            {{else if or (eq .Invoice.Invoice.Status "sent") (eq .Invoice.Invoice.Status "viewed") (eq .Invoice.Invoice.Status "overdue")}}
            <a href="/admin/invoices/{{.Invoice.Invoice.ID}}/payment">
                {{template "button" (dict
                    "Content" "Record Payment"
                    "Variant" "solid"
                    "Color" "green")}}
            </a>
            {{if ne .Invoice.Invoice.Status "overdue"}}
            <form method="POST" action="/admin/invoices/{{.Invoice.Invoice.ID}}/void"
                  onsubmit="return confirm('Are you sure you want to void this invoice?')">
                {{template "button" (dict
                    "Content" "Void"
                    "Type" "submit"
                    "Variant" "outline"
                    "Color" "red")}}
            </form>
            {{end}}
            {{end}}
        </div>
    </div>

    <div class="grid gap-8 lg:grid-cols-3">
        <!-- Main Content (2/3 width) -->
        <div class="space-y-8 lg:col-span-2">
            <!-- Invoice Items -->
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Line Items")}}

                <div class="mt-6 overflow-x-auto">
                    <table class="min-w-full text-left text-sm/6 text-zinc-950 dark:text-white">
                        <thead class="text-zinc-500 dark:text-zinc-400">
                            <tr>
                                <th class="px-4 py-3 font-medium">Description</th>
                                <th class="px-4 py-3 font-medium">Type</th>
                                <th class="px-4 py-3 font-medium text-right">Qty</th>
                                <th class="px-4 py-3 font-medium text-right">Unit Price</th>
                                <th class="px-4 py-3 font-medium text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-zinc-950/5 dark:divide-white/5">
                            {{range .Items}}
                            <tr>
                                <td class="px-4 py-3">
                                    <div class="font-medium">{{.Description}}</div>
                                </td>
                                <td class="px-4 py-3 text-zinc-600 dark:text-zinc-400 capitalize">{{.ItemType}}</td>
                                <td class="px-4 py-3 text-right">
                                    {{if .Quantity.Valid}}
                                        {{printf "%.0f" .Quantity.Float64}}
                                    {{else}}
                                        1
                                    {{end}}
                                </td>
                                <td class="px-4 py-3 text-right">
                                    ${{printf "%.2f" (divf (add .UnitPriceCents 0.0) 100.0)}}
                                </td>
                                <td class="px-4 py-3 text-right font-medium">
                                    ${{printf "%.2f" (divf (add .TotalPriceCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                        <tfoot class="border-t-2 border-zinc-950/10 dark:border-white/10">
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-right text-zinc-600 dark:text-zinc-400">
                                    Subtotal
                                </td>
                                <td class="px-4 py-2 text-right font-medium">
                                    ${{printf "%.2f" (divf (add .Invoice.Invoice.SubtotalCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{if .Invoice.Invoice.TaxCents}}
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-right text-zinc-600 dark:text-zinc-400">
                                    Tax
                                </td>
                                <td class="px-4 py-2 text-right font-medium">
                                    ${{printf "%.2f" (divf (add .Invoice.Invoice.TaxCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{end}}
                            {{if .Invoice.Invoice.ShippingCents}}
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-right text-zinc-600 dark:text-zinc-400">
                                    Shipping
                                </td>
                                <td class="px-4 py-2 text-right font-medium">
                                    ${{printf "%.2f" (divf (add .Invoice.Invoice.ShippingCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{end}}
                            <tr>
                                <td colspan="4" class="px-4 py-3 text-right font-semibold">
                                    Total
                                </td>
                                <td class="px-4 py-3 text-right text-lg font-semibold">
                                    ${{printf "%.2f" (divf (add .Invoice.Invoice.TotalCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{if .Invoice.Invoice.PaidCents}}
                            <tr>
                                <td colspan="4" class="px-4 py-2 text-right text-green-600 dark:text-green-400">
                                    Paid
                                </td>
                                <td class="px-4 py-2 text-right font-medium text-green-600 dark:text-green-400">
                                    -${{printf "%.2f" (divf (add .Invoice.Invoice.PaidCents 0.0) 100.0)}}
                                </td>
                            </tr>
                            {{end}}
                            <tr>
                                <td colspan="4" class="px-4 py-3 text-right font-bold">
                                    Balance Due
                                </td>
                                <td class="px-4 py-3 text-right text-lg font-bold {{if eq .Invoice.Invoice.BalanceCents 0}}text-green-600 dark:text-green-400{{end}}">
                                    ${{printf "%.2f" (divf (add .Invoice.Invoice.BalanceCents 0.0) 100.0)}}
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>

            <!-- Payments -->
            {{if .Payments}}
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Payment History")}}

                <div class="mt-6 space-y-4">
                    {{range .Payments}}
                    <div class="rounded-lg border border-zinc-950/10 p-4 dark:border-white/10">
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="font-medium text-green-600 dark:text-green-400">
                                    +${{printf "%.2f" (divf (add .AmountCents 0.0) 100.0)}}
                                </div>
                                <div class="mt-1 text-sm text-zinc-600 dark:text-zinc-400 capitalize">
                                    {{.PaymentMethod}}
                                    {{if .PaymentReference.Valid}}
                                    • Ref: {{.PaymentReference.String}}
                                    {{end}}
                                </div>
                            </div>
                            {{template "badge" (dict "Content" .Status "Color" "green")}}
                        </div>
                        {{if .PaymentDate.Valid}}
                        <div class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">
                            Received on {{.PaymentDate.Time.Format "Jan 2, 2006"}}
                        </div>
                        {{end}}
                        {{if .Notes.Valid}}
                        <div class="mt-2 text-sm text-zinc-500 dark:text-zinc-400">
                            {{.Notes.String}}
                        </div>
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </section>
            {{end}}

            <!-- Linked Orders -->
            {{if .Orders}}
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Linked Orders")}}

                <div class="mt-6 space-y-3">
                    {{range .Orders}}
                    <a href="/admin/orders/{{.OrderID}}"
                       class="flex items-center justify-between rounded-lg border border-zinc-950/10 p-4 hover:bg-zinc-50 dark:border-white/10 dark:hover:bg-zinc-800">
                        <div>
                            <div class="font-medium">{{.OrderNumber}}</div>
                            <div class="text-sm text-zinc-500 dark:text-zinc-400">
                                {{if .OrderCreatedAt.Valid}}{{.OrderCreatedAt.Time.Format "Jan 2, 2006"}}{{end}}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-medium">${{printf "%.2f" (divf (add .OrderTotalCents 0.0) 100.0)}}</div>
                            {{if eq .OrderStatus "paid"}}
                                {{template "badge" (dict "Content" "Paid" "Color" "green")}}
                            {{else if eq .OrderStatus "pending"}}
                                {{template "badge" (dict "Content" "Pending" "Color" "amber")}}
                            {{else}}
                                {{template "badge" (dict "Content" .OrderStatus "Color" "zinc")}}
                            {{end}}
                        </div>
                    </a>
                    {{end}}
                </div>
            </section>
            {{end}}
        </div>

        <!-- Sidebar (1/3 width) -->
        <div class="space-y-6">
            <!-- Invoice Status -->
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Status")}}

                <div class="mt-4 space-y-3">
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-zinc-600 dark:text-zinc-400">Invoice Status</span>
                        {{if eq .Invoice.Invoice.Status "draft"}}
                            {{template "badge" (dict "Content" "Draft" "Color" "zinc")}}
                        {{else if eq .Invoice.Invoice.Status "sent"}}
                            {{template "badge" (dict "Content" "Sent" "Color" "blue")}}
                        {{else if eq .Invoice.Invoice.Status "viewed"}}
                            {{template "badge" (dict "Content" "Viewed" "Color" "amber")}}
                        {{else if eq .Invoice.Invoice.Status "paid"}}
                            {{template "badge" (dict "Content" "Paid" "Color" "green")}}
                        {{else if eq .Invoice.Invoice.Status "overdue"}}
                            {{template "badge" (dict "Content" "Overdue" "Color" "red")}}
                        {{else if eq .Invoice.Invoice.Status "void"}}
                            {{template "badge" (dict "Content" "Void" "Color" "zinc")}}
                        {{else}}
                            {{template "badge" (dict "Content" .Invoice.Invoice.Status "Color" "zinc")}}
                        {{end}}
                    </div>
                    {{if .Invoice.Invoice.DueDate.Valid}}
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-zinc-600 dark:text-zinc-400">Due Date</span>
                        <span class="text-sm font-medium">{{.Invoice.Invoice.DueDate.Time.Format "Jan 2, 2006"}}</span>
                    </div>
                    {{end}}
                    {{if .Invoice.Invoice.SentAt.Valid}}
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-zinc-600 dark:text-zinc-400">Sent At</span>
                        <span class="text-sm font-medium">{{.Invoice.Invoice.SentAt.Time.Format "Jan 2, 2006"}}</span>
                    </div>
                    {{end}}
                    {{if .Invoice.Invoice.PaidAt.Valid}}
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-zinc-600 dark:text-zinc-400">Paid At</span>
                        <span class="text-sm font-medium">{{.Invoice.Invoice.PaidAt.Time.Format "Jan 2, 2006"}}</span>
                    </div>
                    {{end}}
                </div>
            </section>

            <!-- Customer Info -->
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Customer")}}

                <div class="mt-4 space-y-2">
                    {{if .Invoice.CustomerName}}
                    <div>
                        <div class="text-sm text-zinc-600 dark:text-zinc-400">Name</div>
                        <div class="mt-1">{{.Invoice.CustomerName}}</div>
                    </div>
                    {{end}}
                    {{if .Invoice.CompanyName}}
                    <div>
                        <div class="text-sm text-zinc-600 dark:text-zinc-400">Company</div>
                        <div class="mt-1">{{.Invoice.CompanyName}}</div>
                    </div>
                    {{end}}
                    {{if .Invoice.CustomerEmail}}
                    <div>
                        <div class="text-sm text-zinc-600 dark:text-zinc-400">Email</div>
                        <div class="mt-1">{{.Invoice.CustomerEmail}}</div>
                    </div>
                    {{end}}
                </div>
            </section>

            <!-- Billing Address -->
            {{if .Invoice.Invoice.BillingAddressID.Valid}}
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Billing Address")}}

                <div class="mt-4 text-sm">
                    <!-- Address will be loaded from the billing_address_id -->
                    <div class="text-zinc-500 dark:text-zinc-400">
                        Address ID: {{.Invoice.Invoice.BillingAddressID}}
                    </div>
                </div>
            </section>
            {{end}}

            <!-- Stripe Info -->
            {{if .Invoice.Invoice.StripeInvoiceID.Valid}}
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Stripe")}}

                <div class="mt-4 space-y-2 text-sm">
                    <div>
                        <div class="text-zinc-600 dark:text-zinc-400">Invoice ID</div>
                        <div class="mt-1 font-mono text-xs">{{.Invoice.Invoice.StripeInvoiceID.String}}</div>
                    </div>
                    {{if .Invoice.Invoice.StripeInvoiceURL.Valid}}
                    <div class="mt-3">
                        <a href="{{.Invoice.Invoice.StripeInvoiceURL.String}}"
                           target="_blank"
                           class="text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300">
                            View in Stripe →
                        </a>
                    </div>
                    {{end}}
                </div>
            </section>
            {{end}}

            <!-- Notes -->
            {{if .Invoice.Invoice.Notes.Valid}}
            <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
                {{template "heading" (dict "Level" "3" "Content" "Notes")}}

                <div class="mt-4 text-sm text-zinc-600 dark:text-zinc-400">
                    {{.Invoice.Invoice.Notes.String}}
                </div>
            </section>
            {{end}}
        </div>
    </div>
</div>
{{end}}
