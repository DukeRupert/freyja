{{define "title"}}{{ternary .SKU.ID.Valid "Edit SKU" "New SKU"}} - {{.Product.Name}}{{end}}

{{define "content"}}
<div class="mx-auto max-w-4xl space-y-8">
    <!-- Back Link -->
    <div>
        <a href="/admin/products/{{.Product.ID}}"
           class="inline-flex items-center gap-2 text-sm/6 text-zinc-500 hover:text-zinc-950 dark:text-zinc-400 dark:hover:text-white">
            ‚Üê Back to {{.Product.Name}}
        </a>
    </div>

    <!-- Page Header -->
    {{template "page-header" (dict
        "Title" (ternary .SKU.ID.Valid "Edit SKU" "Add New SKU")
        "Description" "Configure size and grind options for this coffee")}}

    <!-- SKU Form -->
    <form method="POST"
          action="{{if .SKU.ID.Valid}}/admin/products/{{.Product.ID}}/skus/{{.SKU.ID}}/edit{{else}}/admin/products/{{.Product.ID}}/skus/new{{end}}"
          class="space-y-8">

        <!-- SKU Identifier -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "SKU Identifier")}}

            <div class="mt-6">
                {{template "field" (dict
                    "Label" "SKU Code"
                    "Description" (printf "Leave blank to auto-generate (e.g., \"%s-12oz-whole-bean\")" .Product.Slug)
                    "Input" (dict
                        "Type" "text"
                        "ID" "sku"
                        "Name" "sku"
                        "Value" .SKU.Sku
                        "Placeholder" "Will be auto-generated if left blank"))}}
            </div>
        </section>

        <!-- Size Configuration -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "Size")}}

            <div class="mt-6 grid gap-6 sm:grid-cols-2">
                <!-- Weight Value -->
                {{template "field" (dict
                    "Label" "Weight"
                    "Required" true
                    "Input" (dict
                        "Type" "number"
                        "ID" "weight_value"
                        "Name" "weight_value"
                        "Required" true
                        "Value" (ternary .SKU.WeightValue.Valid .SKU.WeightValue.Int 12)
                        "Placeholder" "12"
                        "Step" "any"
                        "Min" "1"))}}

                <!-- Weight Unit -->
                {{template "field" (dict
                    "Label" "Unit"
                    "Required" true
                    "Select" (dict
                        "ID" "weight_unit"
                        "Name" "weight_unit"
                        "Required" true
                        "Value" (default "oz" .SKU.WeightUnit)
                        "Options" (list
                            (dict "Value" "oz" "Label" "Ounces (oz)")
                            (dict "Value" "lb" "Label" "Pounds (lb)")
                            (dict "Value" "g" "Label" "Grams (g)")
                            (dict "Value" "kg" "Label" "Kilograms (kg)"))))}}
            </div>
        </section>

        <!-- Grind Configuration -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "Grind Type")}}

            <div class="mt-6">
                {{template "field" (dict
                    "Label" "Grind"
                    "Required" true
                    "Select" (dict
                        "ID" "grind_type"
                        "Name" "grind_type"
                        "Required" true
                        "Value" (default "whole_bean" .SKU.GrindType)
                        "Options" (list
                            (dict "Value" "whole_bean" "Label" "Whole Bean")
                            (dict "Value" "espresso" "Label" "Espresso")
                            (dict "Value" "fine" "Label" "Fine")
                            (dict "Value" "medium" "Label" "Medium")
                            (dict "Value" "coarse" "Label" "Coarse")
                            (dict "Value" "french_press" "Label" "French Press"))))}}
            </div>
        </section>

        <!-- Pricing -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "Pricing")}}

            <div class="mt-6 space-y-6">
                <!-- Base Price -->
                {{template "field" (dict
                    "Label" "Base Price"
                    "Required" true
                    "Description" (printf "Suggested price: $%s" .SuggestedPrice)
                    "Input" (dict
                        "Type" "number"
                        "ID" "base_price"
                        "Name" "base_price"
                        "Required" true
                        "Value" .BasePriceDollars
                        "Placeholder" .SuggestedPrice
                        "Step" "0.01"
                        "Min" "0"))}}

                <div class="rounded-lg bg-blue-50 p-4 ring-1 ring-blue-600/20 dark:bg-blue-500/10 dark:ring-blue-500/20">
                    <p class="text-sm text-blue-900 dark:text-blue-300">
                        <strong>Note:</strong> This is the default retail price. You can set different prices for wholesale customers using price lists.
                    </p>
                </div>
            </div>
        </section>

        <!-- Inventory Management -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "Inventory")}}

            <div class="mt-6 space-y-6">
                <!-- Track Inventory Checkbox -->
                <div class="flex items-start gap-3">
                    <div class="flex h-6 items-center">
                        <input
                            type="checkbox"
                            id="track_inventory"
                            name="track_inventory"
                            {{if .SKU.TrackInventory}}checked{{end}}
                            class="h-4 w-4 rounded border-zinc-300 text-zinc-950 focus:ring-2 focus:ring-zinc-950 dark:border-white/10 dark:bg-white/5 dark:focus:ring-white">
                    </div>
                    <div class="flex-1">
                        <label for="track_inventory" class="text-base/6 font-medium text-zinc-950 dark:text-white">
                            Track inventory for this SKU
                        </label>
                        <p class="text-sm/6 text-zinc-500 dark:text-zinc-400">
                            Enable to manage stock levels and show availability
                        </p>
                    </div>
                </div>

                <!-- Stock Quantity (shown if tracking) -->
                <div x-data="{trackInventory: {{.SKU.TrackInventory}}}"
                     x-init="$watch('trackInventory', value => document.getElementById('stock_quantity').disabled = !value)">
                    {{template "field" (dict
                        "Label" "Stock Quantity"
                        "Description" "Current number of units in stock"
                        "Input" (dict
                            "Type" "number"
                            "ID" "stock_quantity"
                            "Name" "stock_quantity"
                            "Value" .SKU.StockQuantity
                            "Placeholder" "0"
                            "Min" "0"
                            "Disabled" (not .SKU.TrackInventory)))}}
                </div>

                <!-- Low Stock Threshold -->
                <div x-show="trackInventory">
                    {{template "field" (dict
                        "Label" "Low Stock Alert Threshold"
                        "Description" "Get notified when stock falls below this number"
                        "Input" (dict
                            "Type" "number"
                            "ID" "low_stock_threshold"
                            "Name" "low_stock_threshold"
                            "Value" (ternary .SKU.LowStockThreshold.Valid .SKU.LowStockThreshold.Int32 5)
                            "Placeholder" "5"
                            "Min" "0"))}}
                </div>
            </div>
        </section>

        <!-- Status -->
        <section class="rounded-2xl bg-white p-6 ring-1 ring-zinc-950/5 dark:bg-zinc-900 dark:ring-white/10">
            {{template "heading" (dict "Level" "3" "Content" "Status")}}

            <div class="mt-6">
                <div class="flex items-start gap-3">
                    <div class="flex h-6 items-center">
                        <input
                            type="checkbox"
                            id="is_active"
                            name="is_active"
                            {{if or (not .SKU.ID.Valid) .SKU.IsActive}}checked{{end}}
                            class="h-4 w-4 rounded border-zinc-300 text-zinc-950 focus:ring-2 focus:ring-zinc-950 dark:border-white/10 dark:bg-white/5 dark:focus:ring-white">
                    </div>
                    <div class="flex-1">
                        <label for="is_active" class="text-base/6 font-medium text-zinc-950 dark:text-white">
                            Active
                        </label>
                        <p class="text-sm/6 text-zinc-500 dark:text-zinc-400">
                            Make this SKU available for purchase
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Form Actions -->
        <div class="flex justify-end gap-4">
            {{template "button" (dict
                "Content" "Cancel"
                "Variant" "outline"
                "Type" "button"
                "Href" (printf "/admin/products/%s" .Product.ID))}}

            {{template "button" (dict
                "Content" (ternary .SKU.ID.Valid "Update SKU" "Create SKU")
                "Variant" "solid"
                "Color" "zinc"
                "Type" "submit")}}
        </div>
    </form>
</div>

<script>
// Handle track_inventory checkbox toggle
document.getElementById('track_inventory')?.addEventListener('change', function(e) {
    const stockInput = document.getElementById('stock_quantity');
    const lowStockInput = document.getElementById('low_stock_threshold');
    if (stockInput) stockInput.disabled = !e.target.checked;
    if (lowStockInput) lowStockInput.disabled = !e.target.checked;
});
</script>
{{end}}
