{{template "admin/layout.html" .}}

{{define "title"}}{{if .Product.ID}}Edit Product{{else}}New Product{{end}}{{end}}

{{define "content"}}
<div class="max-w-4xl">
    <!-- Page Header -->
    <div class="mb-6">
        <div class="flex items-center space-x-4 mb-2">
            <a href="/admin/products" class="text-neutral-600 hover:text-neutral-900">‚Üê Back to Products</a>
        </div>
        <h2 class="text-2xl font-semibold text-neutral-900">
            {{if .Product.ID}}Edit Product{{else}}New Product{{end}}
        </h2>
    </div>

    <!-- Product Form -->
    <form method="POST" action="{{if .Product.ID}}/admin/products/{{.Product.ID}}/edit{{else}}/admin/products/new{{end}}" class="space-y-8">

        <!-- Basic Information -->
        <div class="bg-white rounded-lg border border-neutral-200 p-6">
            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Basic Information</h3>

            <div class="space-y-4">
                <!-- Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-neutral-700 mb-1">
                        Product Name <span class="text-red-600">*</span>
                    </label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        required
                        value="{{.Product.Name}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Ethiopian Yirgacheffe"
                    >
                </div>

                <!-- Slug -->
                <div>
                    <label for="slug" class="block text-sm font-medium text-neutral-700 mb-1">
                        URL Slug <span class="text-red-600">*</span>
                    </label>
                    <input
                        type="text"
                        id="slug"
                        name="slug"
                        required
                        value="{{.Product.Slug}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="ethiopian-yirgacheffe"
                    >
                    <p class="text-xs text-neutral-500 mt-1">Used in the URL. Lowercase, hyphens only.</p>
                </div>

                <!-- Short Description -->
                <div>
                    <label for="short_description" class="block text-sm font-medium text-neutral-700 mb-1">
                        Short Description
                    </label>
                    <input
                        type="text"
                        id="short_description"
                        name="short_description"
                        value="{{if .Product.ShortDescription.Valid}}{{.Product.ShortDescription.String}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Bright and floral with notes of blueberry"
                    >
                </div>

                <!-- Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-neutral-700 mb-1">
                        Full Description
                    </label>
                    <textarea
                        id="description"
                        name="description"
                        rows="4"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Tell the story of this coffee..."
                    >{{if .Product.Description.Valid}}{{.Product.Description.String}}{{end}}</textarea>
                </div>
            </div>
        </div>

        <!-- Coffee Attributes -->
        <div class="bg-white rounded-lg border border-neutral-200 p-6">
            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Coffee Attributes</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Origin -->
                <div>
                    <label for="origin" class="block text-sm font-medium text-neutral-700 mb-1">
                        Origin (Country)
                    </label>
                    <input
                        type="text"
                        id="origin"
                        name="origin"
                        value="{{if .Product.Origin.Valid}}{{.Product.Origin.String}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Ethiopia"
                    >
                </div>

                <!-- Region -->
                <div>
                    <label for="region" class="block text-sm font-medium text-neutral-700 mb-1">
                        Region
                    </label>
                    <input
                        type="text"
                        id="region"
                        name="region"
                        value="{{if .Product.Region.Valid}}{{.Product.Region.String}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Yirgacheffe"
                    >
                </div>

                <!-- Producer -->
                <div>
                    <label for="producer" class="block text-sm font-medium text-neutral-700 mb-1">
                        Producer/Farm
                    </label>
                    <input
                        type="text"
                        id="producer"
                        name="producer"
                        value="{{if .Product.Producer.Valid}}{{.Product.Producer.String}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="Smallholder farmers"
                    >
                </div>

                <!-- Process -->
                <div>
                    <label for="process" class="block text-sm font-medium text-neutral-700 mb-1">
                        Process Method
                    </label>
                    <select
                        id="process"
                        name="process"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                    >
                        <option value="">Select...</option>
                        <option value="washed" {{if eq .Product.Process.String "washed"}}selected{{end}}>Washed</option>
                        <option value="natural" {{if eq .Product.Process.String "natural"}}selected{{end}}>Natural</option>
                        <option value="honey" {{if eq .Product.Process.String "honey"}}selected{{end}}>Honey</option>
                        <option value="pulped_natural" {{if eq .Product.Process.String "pulped_natural"}}selected{{end}}>Pulped Natural</option>
                        <option value="anaerobic" {{if eq .Product.Process.String "anaerobic"}}selected{{end}}>Anaerobic</option>
                    </select>
                </div>

                <!-- Roast Level -->
                <div>
                    <label for="roast_level" class="block text-sm font-medium text-neutral-700 mb-1">
                        Roast Level
                    </label>
                    <select
                        id="roast_level"
                        name="roast_level"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                    >
                        <option value="">Select...</option>
                        <option value="light" {{if eq .Product.RoastLevel.String "light"}}selected{{end}}>Light</option>
                        <option value="medium-light" {{if eq .Product.RoastLevel.String "medium-light"}}selected{{end}}>Medium-Light</option>
                        <option value="medium" {{if eq .Product.RoastLevel.String "medium"}}selected{{end}}>Medium</option>
                        <option value="medium-dark" {{if eq .Product.RoastLevel.String "medium-dark"}}selected{{end}}>Medium-Dark</option>
                        <option value="dark" {{if eq .Product.RoastLevel.String "dark"}}selected{{end}}>Dark</option>
                    </select>
                </div>

                <!-- Elevation Min -->
                <div>
                    <label for="elevation_min" class="block text-sm font-medium text-neutral-700 mb-1">
                        Elevation Min (meters)
                    </label>
                    <input
                        type="number"
                        id="elevation_min"
                        name="elevation_min"
                        value="{{if .Product.ElevationMin.Valid}}{{.Product.ElevationMin.Int32}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="1800"
                    >
                </div>

                <!-- Elevation Max -->
                <div>
                    <label for="elevation_max" class="block text-sm font-medium text-neutral-700 mb-1">
                        Elevation Max (meters)
                    </label>
                    <input
                        type="number"
                        id="elevation_max"
                        name="elevation_max"
                        value="{{if .Product.ElevationMax.Valid}}{{.Product.ElevationMax.Int32}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="2200"
                    >
                </div>

                <!-- Tasting Notes (will handle as comma-separated for now) -->
                <div class="md:col-span-2">
                    <label for="tasting_notes" class="block text-sm font-medium text-neutral-700 mb-1">
                        Tasting Notes
                    </label>
                    <input
                        type="text"
                        id="tasting_notes"
                        name="tasting_notes"
                        value="{{if .Product.TastingNotes}}{{.TastingNotesString}}{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="blueberry, floral, citrus (comma-separated)"
                    >
                    <p class="text-xs text-neutral-500 mt-1">Separate multiple notes with commas.</p>
                </div>
            </div>
        </div>

        <!-- Status & Visibility -->
        <div class="bg-white rounded-lg border border-neutral-200 p-6">
            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Status & Visibility</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Status -->
                <div>
                    <label for="status" class="block text-sm font-medium text-neutral-700 mb-1">
                        Status <span class="text-red-600">*</span>
                    </label>
                    <select
                        id="status"
                        name="status"
                        required
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                    >
                        <option value="draft" {{if eq .Product.Status "draft"}}selected{{end}}>Draft</option>
                        <option value="active" {{if eq .Product.Status "active"}}selected{{end}}>Active</option>
                        <option value="archived" {{if eq .Product.Status "archived"}}selected{{end}}>Archived</option>
                    </select>
                </div>

                <!-- Visibility -->
                <div>
                    <label for="visibility" class="block text-sm font-medium text-neutral-700 mb-1">
                        Visibility <span class="text-red-600">*</span>
                    </label>
                    <select
                        id="visibility"
                        name="visibility"
                        required
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                    >
                        <option value="public" {{if eq .Product.Visibility "public"}}selected{{end}}>Public</option>
                        <option value="wholesale" {{if eq .Product.Visibility "wholesale"}}selected{{end}}>Wholesale Only</option>
                        <option value="hidden" {{if eq .Product.Visibility "hidden"}}selected{{end}}>Hidden</option>
                    </select>
                </div>

                <!-- Sort Order -->
                <div>
                    <label for="sort_order" class="block text-sm font-medium text-neutral-700 mb-1">
                        Sort Order
                    </label>
                    <input
                        type="number"
                        id="sort_order"
                        name="sort_order"
                        value="{{if .Product.SortOrder.Valid}}{{.Product.SortOrder.Int32}}{{else}}0{{end}}"
                        class="w-full px-3 py-2 border border-neutral-300 rounded-md focus:outline-none focus:ring-2 focus:ring-teal-500"
                        placeholder="0"
                    >
                    <p class="text-xs text-neutral-500 mt-1">Lower numbers appear first.</p>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-4">
            <a href="/admin/products" class="px-4 py-2 border border-neutral-300 rounded-md text-neutral-700 hover:bg-neutral-50">
                Cancel
            </a>
            <button
                type="submit"
                class="px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700"
            >
                {{if .Product.ID}}Update Product{{else}}Create Product{{end}}
            </button>
        </div>
    </form>

    <!-- Note about SKUs -->
    {{if .Product.ID}}
    <div class="mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg">
        <p class="text-sm text-blue-800">
            <strong>Note:</strong> After saving, you can manage SKUs (sizes and grind options), pricing, and images from the product detail page.
        </p>
    </div>
    {{end}}
</div>
{{end}}
