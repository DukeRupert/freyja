{{define "title"}}{{.Product.Name}} - Freyja Coffee{{end}}

{{define "content"}}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <!-- Breadcrumb Navigation -->
  <nav class="mb-6" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm text-neutral-600">
      <li><a href="/products" class="hover:text-teal-700">Coffee</a></li>
      <li><span class="text-neutral-400">/</span></li>
      <li class="text-neutral-900">{{.Product.Name}}</li>
    </ol>
  </nav>

  <!-- Product Detail Layout -->
  <div class="lg:grid lg:grid-cols-2 lg:gap-12">

    <!-- Left Column: Image -->
    <div>
      <div class="aspect-square bg-neutral-100 rounded-lg overflow-hidden flex items-center justify-center">
        <svg class="w-32 h-32 text-neutral-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
    </div>

    <!-- Right Column: Product Info & Purchase -->
    <div class="mt-8 lg:mt-0">

      <!-- Product Title -->
      <h1 class="text-2xl font-semibold text-neutral-900">{{.Product.Name}}</h1>

      <!-- Origin & Roast Level -->
      <div class="mt-3 flex items-center gap-3 flex-wrap">
        {{if .Product.Origin.Valid}}
        <span class="text-sm text-neutral-600">{{.Product.Origin.String}}</span>
        {{end}}

        {{if .Product.RoastLevel.Valid}}
        <span class="badge-amber">
          {{.Product.RoastLevel.String}}
        </span>
        {{end}}
      </div>

      <!-- Coffee Attributes -->
      {{if or .Product.Producer.Valid .Product.Process.Valid .Product.Elevation.Valid}}
      <div class="mt-6 space-y-3 border-t border-neutral-200 pt-6">
        {{if .Product.Producer.Valid}}
        <div class="flex justify-between text-sm">
          <span class="text-neutral-600">Producer</span>
          <span class="text-neutral-900 font-medium">{{.Product.Producer.String}}</span>
        </div>
        {{end}}

        {{if .Product.Process.Valid}}
        <div class="flex justify-between text-sm">
          <span class="text-neutral-600">Process</span>
          <span class="text-neutral-900 font-medium">{{.Product.Process.String}}</span>
        </div>
        {{end}}

        {{if .Product.Elevation.Valid}}
        <div class="flex justify-between text-sm">
          <span class="text-neutral-600">Elevation</span>
          <span class="text-neutral-900 font-medium">{{.Product.Elevation.String}}</span>
        </div>
        {{end}}
      </div>
      {{end}}

      <!-- Tasting Notes -->
      {{if .Product.TastingNotes}}
      <div class="mt-6 border-t border-neutral-200 pt-6">
        <h2 class="text-sm font-medium text-neutral-700">Tasting Notes</h2>
        <p class="mt-2 text-sm text-neutral-900">
          {{range $i, $note := .Product.TastingNotes}}{{if $i}}, {{end}}{{$note}}{{end}}
        </p>
      </div>
      {{end}}

      <!-- Description -->
      {{if .Product.Description.Valid}}
      <div class="mt-6 border-t border-neutral-200 pt-6">
        <h2 class="text-sm font-medium text-neutral-700">About</h2>
        <p class="mt-2 text-sm text-neutral-700 leading-relaxed whitespace-pre-line">
          {{.Product.Description.String}}
        </p>
      </div>
      {{end}}

      <!-- SKU Selection & Add to Cart -->
      <div class="mt-8 border-t border-neutral-200 pt-6">
        {{if .SKUs}}
        <form method="POST" action="/cart/add"
              hx-post="/cart/add"
              hx-target="#cart-feedback"
              hx-swap="innerHTML"
              x-data="productForm()">

          <div class="mb-6">
            <h2 class="text-sm font-medium text-neutral-700 mb-3">Select Options</h2>

            <div class="space-y-3">
              {{range $index, $sku := .SKUs}}
              <label class="flex items-center p-4 border-2 rounded cursor-pointer transition-colors"
                     :class="selectedSKU === '{{$sku.SKU.ID}}' ? 'border-teal-700 bg-teal-50' : 'border-neutral-300 hover:border-neutral-400'">
                <input type="radio"
                       name="sku_id"
                       value="{{$sku.SKU.ID}}"
                       class="sr-only"
                       @change="selectSKU('{{$sku.SKU.ID}}', {{$sku.PriceCents}}, '{{$sku.InventoryMessage}}')">

                <div class="flex-1">
                  <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-neutral-900">
                      {{if $sku.SKU.WeightValue.Valid}}{{$sku.SKU.WeightValue.String}}{{end}}
                      {{if $sku.SKU.WeightUnit.Valid}}{{$sku.SKU.WeightUnit.String}}{{end}}
                      {{if ne $sku.SKU.Grind "whole_bean"}} - {{$sku.SKU.Grind}}{{end}}
                    </span>
                    <span class="text-sm font-medium text-neutral-900">
                      ${{printf "%.2f" (divf $sku.PriceCents 100.0)}}
                    </span>
                  </div>
                  <p class="mt-1 text-xs"
                     :class="'{{$sku.InventoryMessage}}' === 'In stock' ? 'text-green-700' : 'text-amber-700'">
                    {{$sku.InventoryMessage}}
                  </p>
                </div>
              </label>
              {{end}}
            </div>
          </div>

          <!-- Quantity -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-neutral-700 mb-2">Quantity</label>
            <div class="flex items-center gap-3">
              <button type="button"
                      @click="decreaseQty()"
                      class="w-10 h-10 border border-neutral-300 rounded hover:bg-neutral-50 text-neutral-700">
                âˆ’
              </button>
              <input type="number"
                     name="quantity"
                     x-model="quantity"
                     min="1"
                     class="w-20 text-center px-3 py-2 border border-neutral-300 rounded text-sm">
              <button type="button"
                      @click="increaseQty()"
                      class="w-10 h-10 border border-neutral-300 rounded hover:bg-neutral-50 text-neutral-700">
                +
              </button>
            </div>
          </div>

          <!-- Add to Cart Button -->
          <button type="submit"
                  class="btn-primary w-full"
                  :disabled="!selectedSKU">
            Add to Cart
          </button>

          <!-- Feedback Area -->
          <div id="cart-feedback" class="mt-4"></div>

        </form>

        <script>
          function productForm() {
            return {
              selectedSKU: '',
              quantity: 1,
              price: 0,
              inventoryMessage: '',

              selectSKU(skuID, price, inventoryMsg) {
                this.selectedSKU = skuID;
                this.price = price;
                this.inventoryMessage = inventoryMsg;
              },

              increaseQty() {
                this.quantity++;
              },

              decreaseQty() {
                if (this.quantity > 1) this.quantity--;
              }
            }
          }
        </script>

        {{else}}
        <!-- No SKUs Available -->
        <div class="p-4 bg-amber-50 border border-amber-200 rounded text-sm text-amber-800">
          This product is currently unavailable.
        </div>
        {{end}}
      </div>

    </div>

  </div>

</div>
{{end}}
